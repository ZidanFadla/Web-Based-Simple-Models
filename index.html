<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M3 - Web Based Simple Model</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            text-align: center;
        }

        h1 {
            margin-top: 40px;
            font-size: 2.5rem;
        }

        .model-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            flex-wrap: wrap;
            gap: 50px;
        }

        canvas {
            width: 750px;
            height: 700px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        canvas:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        @media screen and (max-width: 768px) {
            h1 {
                font-size: 1.6rem;
            }

            canvas {
                height: 350px;
            }
        }
    </style>
</head>

<body>
    <h1>Kelompok 7 Web Based Simple 3D Model</h1>
    <div class="model-container">
        <canvas id="model1"></canvas>
    </div>

    <script>
        function createScene(canvasId, modelFolder, modelFile) {
            const canvas = document.getElementById(canvasId);
            const engine = new BABYLON.Engine(canvas, true);
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color4(0.02, 0.02, 0.02, 1);

            const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 3, 10, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            const target = new BABYLON.TransformNode("target", scene);

            // Ambient light
            const ambientLight = new BABYLON.HemisphericLight("ambientLight", new BABYLON.Vector3(0, 1, 0), scene);
            ambientLight.intensity = 0.4;

            // Spotlights
            const topLight = new BABYLON.SpotLight("topLight", new BABYLON.Vector3(0, 5, 0), new BABYLON.Vector3(0, -1, 0), Math.PI / 3, 2, scene);
            topLight.intensity = 2.5;

            const sideLight = new BABYLON.SpotLight("sideLight", new BABYLON.Vector3(4, 2, 0), new BABYLON.Vector3(-1, -0.2, 0), Math.PI / 3, 2, scene);
            sideLight.intensity = 2.5;

            // LIGHTNING - BIG, FAST, FLASH
            const lightning = new BABYLON.PointLight("lightning", new BABYLON.Vector3(0, 8, 0), scene);
            lightning.diffuse = new BABYLON.Color3(1, 1, 1); // Putih terang
            lightning.range = 10000;
            lightning.intensity = 100;

            function flashLightning() {
                lightning.intensity = 100;
                setTimeout(() => {
                    lightning.intensity = 0;
                    // Optional: double flash
                    setTimeout(() => {
                        lightning.intensity = 10;
                        setTimeout(() => {
                            lightning.intensity = 0;
                        }, 80);
                    }, 100);
                }, 100);
            }

            setInterval(() => {
                flashLightning();
            }, 1000 + Math.random() * 500); // Lebih cepat & acak

            // Shadows
            const shadowGenerator = new BABYLON.ShadowGenerator(2048, topLight);
            shadowGenerator.useExponentialShadowMap = true;

            // Load model
            BABYLON.SceneLoader.ImportMesh("", modelFolder, modelFile, scene, function (meshes) {
                let min = new BABYLON.Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE);
                let max = new BABYLON.Vector3(Number.MIN_VALUE, Number.MIN_VALUE, Number.MIN_VALUE);

                meshes.forEach(mesh => {
                    mesh.computeWorldMatrix(true);
                    const bounding = mesh.getBoundingInfo().boundingBox;
                    min = BABYLON.Vector3.Minimize(min, bounding.minimumWorld);
                    max = BABYLON.Vector3.Maximize(max, bounding.maximumWorld);

                    mesh.receiveShadows = true;
                    shadowGenerator.addShadowCaster(mesh);
                });

                const center = BABYLON.Vector3.Center(min, max);
                const size = max.subtract(min).length();

                camera.target = center;
                camera.radius = size * 1.5;

                target.position = center.clone();
                topLight.setDirectionToTarget(target.position);
                sideLight.setDirectionToTarget(target.position);
            }, null, function (scene, message) {
                console.error("Gagal memuat model:", message);
            });

            engine.runRenderLoop(() => scene.render());
            window.addEventListener("resize", () => engine.resize());
        }

        createScene("model1", "Models/Horse/", "scene.gltf");
    </script>

</body>

</html>